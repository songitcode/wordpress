import{r as u,_ as E,cv as ke,l as s,cw as Pe,cx as z,cy as de,j as a,P as Ve,cz as Ae,ba as Le,a5 as Oe,a6 as D,cA as Be,cB as Ye,cC as ze,cD as ae,cE as oe,cF as Ne,cG as se,e as _,cH as Ue,cI as Y,cJ as re,cK as $e,cL as He,cq as ie,cM as We,a9 as Ge}from"./main-1.0.15.js";import{u as y,N as fe,ab as qe,B as N,am as Je,an as U,S as $,a as Qe,K as Xe,aa as Ze,v as Ke,ao as le,$ as ue,ap as Ie,t as et}from"./main-1.0.15-e2ad00f6.js";import{u as tt,C as nt,a as at,B as k,b as ot}from"./useScreenSize-1.0.15-a1dd46fa.js";import{s as st,u as rt,i as ce}from"./ActionsDml-1.0.15-409ee4a6.js";import{C as it}from"./CardActions-1.0.15-e9dc43ac.js";import{I as lt}from"./iconBase-1.0.15-5866dbfd.js";u.lazy(()=>E(()=>import("./TableContainer-1.0.15-0a988586.js").then(t=>t.T),["./TableContainer-1.0.15-0a988586.js","./main-1.0.15.js","./useScreenSize-1.0.15-a1dd46fa.js","./iconBase-1.0.15-5866dbfd.js","./index.esm-1.0.15-f3c7e2e0.js","./Close-1.0.15-8d33e66c.js","./Menu-1.0.15-3ae4ddd1.js","./main-1.0.15-e2ad00f6.js","./main-1.0.15-b0d40d19.css","./TextField-1.0.15-73384817.js","./FormControlLabel-1.0.15-2f48df6c.js","./MenuItem-1.0.15-cb0e11e9.js","./settings-1.0.15-3913c57c.js","./DialogContent-1.0.15-e50a43f8.js","./Tabs-1.0.15-c2b715a3.js","./settings-1.0.15-a01eb26f.css","./Radio-1.0.15-7d52029a.js","./Checkbox-1.0.15-19533231.js","./AlertTitle-1.0.15-cc3002eb.js","./useSlot-1.0.15-4f7bfdbc.js","./InputAdornment-1.0.15-4ec316af.js","./ListItemIcon-1.0.15-b73952ad.js","./DateTimePicker-1.0.15-b600d307.js","./useMobilePicker-1.0.15-5df19a3e.js","./date-time-utils-1.0.15-31b6fdea.js","./dateViewRenderers-1.0.15-2bbfacab.js","./TimePicker-1.0.15-1545716b.js","./DatePicker-1.0.15-cd97ffeb.js","./ScopeEnum-1.0.15-32d3ffad.js","./ActionsDml-1.0.15-409ee4a6.js","./useStoreTable-1.0.15-ce8ace5b.js","./index.esm-1.0.15-3dc3cbe3.js","./index-1.0.15-3f6c5bf6.js","./TableContainer-1.0.15-9815a209.css"],import.meta.url));u.lazy(()=>E(()=>Promise.resolve().then(()=>H),void 0,import.meta.url));u.lazy(()=>E(()=>import("./TableContainer-1.0.15-0a988586.js").then(t=>t.T),["./TableContainer-1.0.15-0a988586.js","./main-1.0.15.js","./useScreenSize-1.0.15-a1dd46fa.js","./iconBase-1.0.15-5866dbfd.js","./index.esm-1.0.15-f3c7e2e0.js","./Close-1.0.15-8d33e66c.js","./Menu-1.0.15-3ae4ddd1.js","./main-1.0.15-e2ad00f6.js","./main-1.0.15-b0d40d19.css","./TextField-1.0.15-73384817.js","./FormControlLabel-1.0.15-2f48df6c.js","./MenuItem-1.0.15-cb0e11e9.js","./settings-1.0.15-3913c57c.js","./DialogContent-1.0.15-e50a43f8.js","./Tabs-1.0.15-c2b715a3.js","./settings-1.0.15-a01eb26f.css","./Radio-1.0.15-7d52029a.js","./Checkbox-1.0.15-19533231.js","./AlertTitle-1.0.15-cc3002eb.js","./useSlot-1.0.15-4f7bfdbc.js","./InputAdornment-1.0.15-4ec316af.js","./ListItemIcon-1.0.15-b73952ad.js","./DateTimePicker-1.0.15-b600d307.js","./useMobilePicker-1.0.15-5df19a3e.js","./date-time-utils-1.0.15-31b6fdea.js","./dateViewRenderers-1.0.15-2bbfacab.js","./TimePicker-1.0.15-1545716b.js","./DatePicker-1.0.15-cd97ffeb.js","./ScopeEnum-1.0.15-32d3ffad.js","./ActionsDml-1.0.15-409ee4a6.js","./useStoreTable-1.0.15-ce8ace5b.js","./index.esm-1.0.15-3dc3cbe3.js","./index-1.0.15-3f6c5bf6.js","./TableContainer-1.0.15-9815a209.css"],import.meta.url));u.lazy(()=>E(()=>Promise.resolve().then(()=>H),void 0,import.meta.url));u.lazy(()=>E(()=>Promise.resolve().then(()=>H),void 0,import.meta.url));const ut=t=>{const c=y(g=>ke(g,t));return s.debug("storeColumns",c),c},ct=t=>{const c=y(g=>Pe(g,t));return s.debug("moreState",c),c},mt=u.lazy(()=>E(()=>import("./Row-1.0.15-30d35e15.js"),["./Row-1.0.15-30d35e15.js","./main-1.0.15.js","./main-1.0.15-e2ad00f6.js","./iconBase-1.0.15-5866dbfd.js","./main-1.0.15-b0d40d19.css","./useScreenSize-1.0.15-a1dd46fa.js","./ActionsDml-1.0.15-409ee4a6.js","./CardActions-1.0.15-e9dc43ac.js"],import.meta.url)),dt=({appId:t,metaData:c,primaryKey:g,formMode:v,formUuid:M})=>{var p;s.debug(t,c,g,v,M);const b=fe(t),T=qe(t),x=y(f=>z(f,t));s.debug("data",x);const j=y(f=>de(f,t));s.debug("initialData",j);let S="30px";return a.jsx("form",{id:M,className:"pp-form-content",onSubmit:f=>(f.preventDefault(),!1),children:a.jsx(N,{className:"pp-form-grid",sx:{display:"grid",gridTemplateColumns:{lg:`repeat(${b.cellsPerRow}, 1fr)`,md:"repeat("+Math.min(b.cellsPerRow,2)+", 1fr)",xs:"1fr"},gap:S,marginBottom:0,background:b.showGrid?((p=Je)==null?void 0:p.palette.mode)===Ve.LIGHT?"repeating-linear-gradient( -45deg, transparent, transparent 10px, #eee 10px, #eee 20px )":"repeating-linear-gradient( -45deg, transparent, transparent 10px, #111 10px, #111 20px )":"","& p.MuiFormHelperText-root":{...v===U.VIEW&&!0&&{display:"none"}}},children:a.jsx(u.Suspense,{fallback:a.jsx($,{}),children:a.jsx(mt,{appId:t,metaData:c,data:x,initialData:j,primaryKey:g,formMode:v,formSettings:b,language:T.language})})})})};var ft=Ae();const A=Le(ft);const gt=u.lazy(()=>E(()=>import("./Alert-1.0.15-5097a608.js"),["./Alert-1.0.15-5097a608.js","./main-1.0.15.js","./index.esm-1.0.15-bb4db28d.js","./iconBase-1.0.15-5866dbfd.js","./AlertTitle-1.0.15-cc3002eb.js","./Close-1.0.15-8d33e66c.js","./useSlot-1.0.15-4f7bfdbc.js"],import.meta.url)),xt=({appId:t,primaryKey:c,formMode:g,showTable:v,showForm:M,detailKey:b,children:T,relationAppId:x,relTab:j,joinTab:S,isEmbedded:p})=>{var ee,te;s.debug(t,c,g,b,x,j,S,p);const f=Qe(),L=ut(t),m=Xe(t),ge=Ze(),W=u.useMemo(()=>Ke(),[]),[xe,O]=u.useState(!1),[G,_e]=u.useState(""),o=u.useMemo(()=>Oe(D.getState(),t),[t]);s.debug("metaData",o);const F=Be((ee=o==null?void 0:o.app)==null?void 0:ee.container[0]),P=y(n=>z(n,t));s.debug("data",P);const ve=y(n=>de(n,t));s.debug("initialData",ve);const B=y(n=>Ye(n,t));s.debug("m2mUpdate",B),u.useEffect(()=>{B===!0&&V(!1,()=>{f(oe({appId:t,update:!1}))})},[B]),u.useEffect(()=>{c===null?be():Object.keys(c).length>0?he():O(!0)},[c]);const he=()=>{st(t,c,o==null?void 0:o.media,n=>{if(s.debug(n),n!==null){const i={...n.context};delete i.debug;const l={...n.data[0]};f(ae({appId:t,data:l,context:i})),O(n!==null)}else _(m.invalidResponse,{variant:"error"})},n=>{s.error("error",n),_e(n??m.invalidResponse)},!1,j)},be=()=>{var n,i;if(o.columns&&Array.isArray(o.columns)){const l={},r=ze(D.getState(),t);s.debug("defaultValues",r);for(let e=0;e<o.columns.length;e++)l[o.columns[e].column_name]=null,r[o.columns[e].column_name]!==void 0&&(r[o.columns[e].column_name]==="@wpda_wp_user_id"?l[o.columns[e].column_name]=(i=(n=o==null?void 0:o.settings)==null?void 0:n.env)==null?void 0:i.id:r[o.columns[e].column_name]==="@now"?o.columns[e]==="date"?l[o.columns[e].column_name]=A(Date.now()).format("YYYY-MM-DD"):l[o.columns[e].column_name]=A(Date.now()).format("YYYY-MM-DD HH:mm:ss"):o.columns[e].column_default!==null&&o.columns[e].column_default!==""?o.columns[e].column_default==="CURRENT_TIMESTAMP"?o.columns[e]==="date"?l[o.columns[e].column_name]=A(Date.now()).format("YYYY-MM-DD"):l[o.columns[e].column_name]=A(Date.now()).format("YYYY-MM-DD HH:mm:ss"):l[o.columns[e].column_name]=o.columns[e].column_default:l[o.columns[e].column_name]=r[o.columns[e].column_name]);s.debug(l),f(ae({appId:t,data:l,context:{media:{}}})),s.debug("init"),O(!0)}},q=()=>{let n="";for(const i in o.columns)o.columns[i].extra==="auto_increment"&&(n=o.columns[i].column_name);return s.debug(n),n},je=n=>{for(let i=0;i<o.columns.length;i++)if(o.columns[i].column_name===n)return o.columns[i]},J=n=>{const i=Ue(D.getState(),t);s.debug("rowValidation",i);let l=!1;for(const d in i)if(i[d].error===!0&&i[d].type===Y.COLUMN){l=!0;break}if(l)return s.debug("validateForm returned errors"),!1;let r=!0;const e=q();for(const d in n){const h=je(d);let ne=!0;h.column_name!==e&&h.is_nullable==="NO"&&(n[d]===""&&(g===U.INSERT||Ee.preserveSpacesOnUpdate===!1)||n[d]===null||n[d]===void 0)&&(f(re({appId:t,columnName:d,columnError:!0,columnText:m.mandatoryField,columnType:Y.FORM})),ne=!1,r=!1);const we=$e(D.getState(),t,d);s.debug(we),ne&&f(re({appId:t,columnName:d,columnError:!1,columnText:"",columnType:Y.FORM}))}return r},V=(n,i)=>{const l=z(D.getState(),t);if(s.debug(l),J(l)){if(c!==null){const r={};Object.keys(l).map(e=>{L.map(d=>{e===d.columnName&&d.updatable&&(r[e]=l[e])})}),s.debug(r),rt(t,c,r,e=>{var d;if(s.debug(e),e!=null&&e.code&&(e!=null&&e.message))switch(e.code){case"ok":_(m.updatedSuccessful,{variant:"success"}),((d=e.context)==null?void 0:d.updated)!==void 0&&Object.keys(e.context.updated).map(h=>{f(He({appId:t,columnName:h,columnValue:e.context.updated[h]}))}),n&&(i!==void 0&&i(c),setTimeout(()=>{v(!0,x)},1e3));break;case"info":_(m.nothingToUpdate,{variant:"info"}),n&&(i!==void 0&&i(c),setTimeout(()=>{v(!0,x)},1e3));break;default:s.error(e),_(e.message??m.invalidResponse,{variant:"error"}),n&&v(!0,x)}else s.error(e),_(m.invalidResponse,{variant:"error"})},e=>{s.error("error",e),_(e??m.invalidResponse,{variant:"error"})},!1,S,j)}else ce(t,l,r=>{if(s.debug(r),r!=null&&r.code&&(r!=null&&r.message)){let e;const d={};switch(r.code){case"ok":_(m.insertSuccessful,{variant:"success"}),e=q();for(let h=0;h<o.primary_key.length;h++)e!==""?d[o.primary_key[h]]=r.context.insert_id:d[o.primary_key[h]]=l[o.primary_key[h]];if(s.debug(d),n){i!==void 0&&i(d),v(!0,x);return}M(d,Ie.UPDATE);break;default:s.error(r),_(r.message??m.invalidResponse,{variant:"error"})}}else s.error(r),_(m.invalidResponse,{variant:"error"})},r=>{s.error("error",r),_(r??m.invalidResponse,{variant:"error"})},!1,S,j);x!==void 0&&f(oe({appId:x,update:!0}))}},Se=n=>{if(n!==null&&J(P)){const i=ie(D.getState(),t),l=i.state.relation.relation_join_condition.split(",").map(e=>e.split("=")),r={...i.state.detailKey};l.map(e=>{r[e[0]]=P[e[1]]}),ce(t,r,e=>{if(s.debug(e),e!=null&&e.code&&(e!=null&&e.message))switch(e.code){case"ok":s.debug("Added relation to join table",e);break;default:s.error(e),_(e.message??m.invalidResponse,{variant:"error"})}else s.error(e),_(m.invalidResponse,{variant:"error"})},e=>{s.error(e),_(e??m.invalidResponse,{variant:"error"})},!1,!0,!1)}},Re=()=>{V(!1)},ye=()=>{const n=ie(D.getState(),t);s.debug(n.state.relation),n.state.relation!==void 0&&n.state.relation.cardinality===We.MANY_TO_MANY?V(!0,Se):V(!0)},Q=()=>{v(!0,x)},Ee=fe(t),X=y(n=>Ne(n,t));s.debug("moreEnabled",X);const w=ct(t),C=u.useRef(null),[R,pe]=u.useState((te=C==null?void 0:C.current)==null?void 0:te.offsetWidth),[Ce,De]=u.useState({paddingTop:"50px",paddingBottom:"50px",paddingLeft:"50px",paddingRight:"50px"}),[Me,Z]=u.useState("30px"),[Te,K]=u.useState(""),Fe=tt();if(u.useEffect(()=>{if(C.current!==null){pe(C.current.offsetWidth);const n=R<600?.3:R<900?.6:1;De({paddingTop:`calc(${n} * 50px)`,paddingBottom:`calc(${n} * 50px)`,paddingLeft:`calc(${n} * 50px)`,paddingRight:`calc(${n} * 50px)`}),R<600?Z("10px"):R<900&&Z("20px"),R<600?K("10px"):R<900&&K("20px")}},[Fe.width,C.current]),G!=="")return a.jsx(u.Suspense,{children:a.jsx(gt,{severity:"error",message:G,close:!1})});const I=()=>a.jsx(dt,{appId:t,metaData:o,primaryKey:c,formMode:g,formUuid:W});return p?I():a.jsx("div",{className:`${t}_wrapper pp-form`,ref:C,children:xe&&P!==null?a.jsxs(nt,{sx:Ce,elevation:ge,children:[a.jsxs(at,{sx:{padding:0,margin:"5px 0 0 0"},children:[I(),T]}),a.jsxs(it,{sx:{marginTop:{marginTop:Me},paddingRight:{paddingRight:Te},padding:0,justifyContent:"space-between",alignItems:"center"},children:[a.jsxs(N,{sx:{display:"flex",gap:"8px"},children:[!1,X&&a.jsx(a.Fragment,{children:R<600?a.jsx(lt,{color:"primary",onClick:()=>{f(se({appId:t,more:!w}))},children:w?a.jsx(le,{}):a.jsx(ue,{})}):a.jsx(k,{variant:"outlined",startIcon:w?a.jsx(le,{}):a.jsx(ue,{}),onClick:()=>{f(se({appId:t,more:!w}))},children:w?m.less:m.more})})]}),a.jsx(N,{sx:{...R<600&&{marginLeft:"0 !important","& button":{marginLeft:"2px",padding:"6px"}}},children:g!==U.VIEW?a.jsxs(a.Fragment,{children:[a.jsx(k,{variant:"contained",onClick:Re,type:"submit",form:W,children:m.apply}),(F==null?void 0:F.cardinality)!==0&&a.jsxs(a.Fragment,{children:[a.jsx(k,{variant:"outlined",onClick:ye,sx:{marginLeft:"8px"},children:m.ok}),a.jsx(k,{variant:"outlined",onClick:Q,sx:{marginLeft:"8px"},children:m.cancel})]})]}):a.jsx(a.Fragment,{children:(F==null?void 0:F.cardinality)!==0&&a.jsx(k,{variant:"contained",onClick:Q,children:m.back})})})]}),a.jsx(a.Fragment,{children:!1})]}):a.jsx("div",{style:{padding:"50px"},children:a.jsx($,{title:m.loadingData})})})},_t=u.lazy(()=>E(()=>import("./Settings-1.0.15-0383eb57.js"),["./Settings-1.0.15-0383eb57.js","./main-1.0.15.js","./main-1.0.15-e2ad00f6.js","./iconBase-1.0.15-5866dbfd.js","./main-1.0.15-b0d40d19.css","./useScreenSize-1.0.15-a1dd46fa.js","./useMetadataColumns-1.0.15-a0d5d42d.js","./useStoreTable-1.0.15-ce8ace5b.js","./useFormStore-1.0.15-33a2aa16.js","./Stepper-1.0.15-7dbc23a7.js","./Close-1.0.15-8d33e66c.js","./settings-1.0.15-3913c57c.js","./FormControlLabel-1.0.15-2f48df6c.js","./TextField-1.0.15-73384817.js","./Menu-1.0.15-3ae4ddd1.js","./DialogContent-1.0.15-e50a43f8.js","./Tabs-1.0.15-c2b715a3.js","./settings-1.0.15-a01eb26f.css","./index.esm-1.0.15-8ab178c0.js","./ActionsDml-1.0.15-409ee4a6.js","./index.esm-1.0.15-3dc3cbe3.js","./MenuItem-1.0.15-cb0e11e9.js","./index-1.0.15-c2b31918.js","./useTableUpdater-1.0.15-5d031e17.js","./Checkbox-1.0.15-19533231.js","./Link-1.0.15-0c287b6b.js","./AccordionSummary-1.0.15-ad1892ca.js","./useSlot-1.0.15-4f7bfdbc.js","./SettingsFormRelationships-1.0.15-8b815d08.js","./useApp-1.0.15-ae446897.js","./ActionsApp-1.0.15-ae4a30d5.js","./ActionsExplorer-1.0.15-15df1613.js","./PremiumFeature-1.0.15-58839b47.js","./EnumTypeEnum-1.0.15-7ffcf33a.js","./ScopeEnum-1.0.15-32d3ffad.js","./RadioGroup-1.0.15-f84d6091.js","./Radio-1.0.15-7d52029a.js","./CssUnitTextField-1.0.15-59b5f257.js","./ThemeSettings-1.0.15-957988d2.js","./index-1.0.15-3f6c5bf6.js"],import.meta.url)),me=({appId:t,primaryKey:c,formMode:g,showTable:v,showForm:M,metaData:b,detailKey:T,selectionForm:x})=>{s.debug(t,c,g,b,T,x);const j=ot(),S=u.useMemo(()=>{},[]);s.debug("relationAppId",S);const p=()=>null,f=()=>null,L=()=>null;return a.jsxs(a.Fragment,{children:[x===!0?a.jsx(a.Fragment,{children:p()}):a.jsx(xt,{appId:t,primaryKey:c,formMode:g,showTable:v,showForm:M,detailKey:T,relationAppId:S,children:f()}),Ge(b)&&a.jsx(et,{theme:j,children:a.jsx(u.Suspense,{fallback:a.jsx($,{title:"Loading form settings..."}),children:a.jsx(_t,{appId:t})})}),L()]})},H=Object.freeze(Object.defineProperty({__proto__:null,FormContainer:me,default:me},Symbol.toStringTag,{value:"Module"}));export{H as F,ct as a,A as d,ut as u};
