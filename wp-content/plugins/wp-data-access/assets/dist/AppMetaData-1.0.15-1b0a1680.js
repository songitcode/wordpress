import{r as l,j as t,a0 as _,l as u,a1 as H,a2 as U,a3 as q,a4 as G,a5 as J,a6 as K,W as Q,a7 as V,a8 as X,a9 as Y,F as N,aa as Z,ab as I,e as R,C as S,A as ee,ac as te}from"./main-1.0.15.js";import{B as f,u as y,a as F,G as se,T as O,H as ae,D as L,k as pe,I as ne,R as re,J as oe,v as ie,K as le,L as ce,N as ue,O as de,P as me,S as w,t as xe,A as he,g as ge,h as fe,Q as k,U as D,V as Ae}from"./main-1.0.15-e2ad00f6.js";import{b as Se}from"./ActionsApp-1.0.15-ae4a30d5.js";import je from"./Alert-1.0.15-5097a608.js";import{I as B}from"./iconBase-1.0.15-5866dbfd.js";import{M as be}from"./MenuItem-1.0.15-cb0e11e9.js";import{M as ve}from"./Menu-1.0.15-3ae4ddd1.js";const ye=({appRootId:e,appId:s,appDbId:r,isVisible:a,fullScreen:m})=>{const[x,o]=l.useState(!1);return l.useEffect(()=>{a&&!x&&o(!0)},[a]),x?t.jsx(f,{className:a?"pp-app-show":"pp-app-hide",sx:{"& .pp-app-container .pp-component header":{margin:0},"& .pp-app-container .pp-component header *":{visibility:"hidden",position:"fixed"}},children:t.jsx(Pe,{appId:s,appDbId:r,fullScreen:m,appRootId:e})}):null},Ce=e=>{const s=y(r=>_(r,e));return u.debug("activeAppId",s,e),s},Te=e=>{const s=y(r=>H(r,e));return u.debug("appData",s),s},Me=({appId:e})=>{const s=F(),r=se(e),a=Te(e);return t.jsx(O,{title:t.jsx(ae,{details:r,mode:a==null?void 0:a.mode}),className:"pp-builder-button",children:t.jsx(B,{sx:{color:"inherit",padding:0},onClick:()=>{(a==null?void 0:a.mode)===L.FORM?s(U({appId:e})):s(q({appId:e}))},children:t.jsx(pe,{})})})},Ee=({appDbId:e,appTitle:s,setActiveApp:r,handleClose:a})=>t.jsx(be,{onClick:()=>{r(e),a()},children:t.jsx("span",{children:s})}),Fe=({apps:e,setActiveApp:s})=>{const[r,a]=l.useState(null),m=!!r,x=p=>{a(p.currentTarget),p.stopPropagation()},o=()=>{a(null)};return t.jsxs(f,{sx:{position:"relative"},children:[t.jsx(B,{sx:{color:"inherit",padding:0},onClick:x,children:t.jsx(ne,{})}),t.jsxs(ve,{anchorEl:r,open:m,onClose:o,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{marginTop:"8px","& ul":{padding:"0 !important"},"& ul li":{padding:"12px 18px !important"}},children:[...e.apps.map(p=>t.jsx(Ee,{appDbId:p,appTitle:e.titles[p],setActiveApp:s,handleClose:o}))]})]})},Be=({appId:e})=>{var P;u.debug(e);const s=F(),r=re(),a=oe(),m=l.useRef(null),x=l.useRef(null),o=y(n=>G(n,e));u.debug("apps",o);const p=l.useMemo(()=>{const n={};return Array.isArray(o.apps)&&o.apps.length>0&&o.apps.map(v=>{n[v]=ie()}),n},[]),j=le(e),c=l.useMemo(()=>J(K.getState(),e),[]),A=l.useMemo(()=>{var n,v;return((v=(n=c==null?void 0:c.app)==null?void 0:n.app[0])==null?void 0:v.app_title)!==""?c.app.app[0].app_title:"WP Data Access"},[]),d=Ce(e),b=n=>{s(I({appId:e,activeAppId:n}))},C=ce(p[d]),T=ue(p[d]),M=de(p[d]),E=me(M,C,T),[h,g]=l.useState(Q.appOrig.appFullscreen===!0);u.debug("appFullScreen",h);const i=y(n=>V(n));u.debug("appData",i),l.useEffect(()=>{u.debug("setFullScreen",p,h),Object.keys(p).map(n=>{s(X({appId:p[Number(n)],fullScreen:h}))})},[i,h]);const z=((P=i[p[d]])==null?void 0:P.mode)??L.TABLE;u.debug("mode",z);let W={};const $=()=>null;return o===void 0||Object.keys(p).length===0?t.jsx(w,{}):t.jsx(xe,{theme:E,children:t.jsxs(f,{className:"pp-apps-container",ref:m,sx:{...h?W:{},"& .pp-app-hide *":{visibility:"hidden",position:"fixed"}},children:[t.jsx(he,{className:"pp-apps-header",ref:x,position:"relative",sx:{margin:"0 0 5px 0"},children:t.jsxs(ge,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(f,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center",gap:"5px","& span":{whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold"},"& span.pp-header-title":{minWidth:0,textOverflow:"ellipsis",overflow:"hidden",marginRight:"10px"}},children:[t.jsx("span",{children:t.jsx(Fe,{apps:o,setActiveApp:b})}),t.jsxs("span",{className:"pp-header-title",children:[A," - ",o.titles[d]]})]}),t.jsxs(f,{sx:{display:"flex",gap:"10px",justifyContent:"center",alignItems:"center"},children:[Y(c)&&t.jsx(Me,{appId:p[d]}),$(),(c==null?void 0:c.isExploring)&&t.jsx(O,{title:j.close,children:t.jsx(B,{sx:{color:"inherit",padding:0},onClick:()=>{s(N({isActive:!1,appDbId:0})),a(e),r(e),s(Z({})),Object.keys(p).map(n=>{a(p[n]),r(p[n])})},children:t.jsx(fe,{})})})]})]})}),...o.apps.map(n=>t.jsx(ye,{appRootId:e,appId:p[n],appDbId:n,isVisible:n===d,fullScreen:h}))]})})},Pe=({appId:e,appDbId:s,designMode:r,staticFilter:a,shortcodeArgs:m,fullScreen:x,isExploring:o,appRootId:p})=>{u.debug(e,s,r,a,m,x,o);const j=F(),[c,A]=l.useState(""),[d,b]=l.useState(!1),[C,T]=l.useState(!1),{prepareAppStore:M}=k(e,D.APP),{prepareApp:E}=k(e,D.APP);l.useEffect(()=>{d||h()},[s]);const h=()=>{Se(s,g=>{const i=g==null?void 0:g.data;u.debug("response data",i),i.app&&i.app.app&&Array.isArray(i.app.app)&&i.app.container&&Array.isArray(i.app.container)&&i.app.apps&&Array.isArray(i.app.apps)?i.app.app[0].app_type===ee.APPCONTAINER.toString()?(E(i,o),T(!0),b(!0)):M(s,i,r===!0,void 0,p,()=>{})?(j(te({appId:e,staticFilter:a,shortcodeArgs:m})),b(!0)):A(S.contactSupport):(R(S.contactSupport,{variant:"error"}),A(S.contactSupport))},g=>{u.error("error",g),R(g??S.contactSupport,{variant:"error"}),A(g??S.contactSupport)})};return c!==""?t.jsx(l.Suspense,{children:t.jsx(je,{severity:"error",message:c,close:!0,setClose:()=>{j(N({isActive:!1,appDbId:0}))}})}):d?C?t.jsx(Be,{appId:e}):t.jsx(f,{id:"pp-app-"+e,className:"pp-app-container pp-app-"+s,sx:{[`&#pp-app-${e} .pp-column-search-field ul`]:{marginLeft:0,padding:0},[`&#pp-app-${e} .pp-global-search-field input, &#pp-app-${e} .pp-column-search-field input`]:{boxSizing:"content-box"},[`&#pp-app-${e} .pp-form form input`]:{boxSizing:"content-box"}},children:t.jsx(Ae,{appId:e})}):t.jsx(f,{sx:{padding:"50px"},children:t.jsx(w,{})})};export{Pe as A};
