import{l as t,r as N,j as e,W as F,cb as C,e0 as W}from"./main-1.0.15.js";import{a as I}from"./main-1.0.15-e2ad00f6.js";import{b as J,c as M,d as E,e as R,f as V}from"./index.esm-1.0.15-3dc3cbe3.js";import{F as B}from"./TextField-1.0.15-73384817.js";import{B as k}from"./useScreenSize-1.0.15-a1dd46fa.js";import"./iconBase-1.0.15-5866dbfd.js";import"./Close-1.0.15-8d33e66c.js";import"./Menu-1.0.15-3ae4ddd1.js";const D="Upload or select %s from your WordPress media library",L=({appId:d,columnName:n,columnValue:f,columnMetaData:x,onColumnChange:h,columnMedia:u,mediaType:p})=>{t.debug(d,n,f,x,u,p);const S=N.useRef(null),m=I(),y=s=>{if(t.debug(s),s!=null&&s.id&&(s!=null&&s.url)&&(s!=null&&s.mime)&&(s!=null&&s.title))return{value:s.id,media:{url:s.url,mime_type:s.mime,title:s.title}}},_=()=>{t.debug("update media");const s=C(x.data_type)!=="number";t.debug(s);let r="media",o="";switch(p){case"WP-Image":r="images(s)",o="image";break;case"WP-Audio":r="audio",o="audio";break;case"WP-Video":r="video(s)",o="video";break}t.debug(r,o);const a=window.wp.media({title:D.replace("%s",r),button:{text:"Select"},library:{type:o},multiple:s,render:!1});t.debug(a),a.on("select",function(){const l=[];if(s){const i=a.state().get("selection").toJSON();t.debug(i),i.map(v=>{t.debug(v);const P=y(v);P&&l.push(P)})}else{const i=y(a.state().get("selection").first().toJSON());i&&l.push(i)}t.debug(l);const c=[],g=[];for(let i=0;i<l.length;i++)c.push(l[i].value),g.push(JSON.stringify(l[i].media));t.debug(c,g),h(n,c.toString()),m(W({appId:d,columnName:n,columnValue:g}))}),a.open()},w=()=>{t.debug("delete media"),h(n,null),m(W({appId:d,columnName:n,columnValue:[]}))},A=s=>{switch(p){case"WP-Image":return e.jsx("img",{src:s.url,title:s.title,alt:s.title});case"WP-Attachment":{const r=s.mime_type.split("/");return e.jsxs("a",{href:s.url,title:s.title,target:"_blank",className:"pp-hyperlink",children:[e.jsxs("div",{children:[r[0]==="image"&&e.jsx(J,{}),r[0]==="audio"&&e.jsx(M,{}),r[0]==="video"&&e.jsx(E,{}),r[0]==="application"?r[1]==="pdf"?e.jsx(R,{}):e.jsx(V,{}):e.jsx(e.Fragment,{})]}),e.jsx("div",{className:"link-label",children:s.title})]})}case"WP-Audio":return e.jsx("audio",{controls:!0,children:e.jsx("source",{src:s.url,type:s.mime_type})});case"WP-Video":return e.jsx("video",{controls:!0,children:e.jsx("source",{src:s.url,type:s.mime_type})})}};return e.jsxs("div",{className:`media ${p}`,children:[e.jsxs(B,{children:[u==null?void 0:u.map(s=>{try{if(s===null||s==="")return null;const r=JSON.parse(s);return r!=null&&r.url?e.jsx("div",{ref:S,className:"content",children:A(r)},r.url):null}catch(r){return t.error("Invalid media properties",r),e.jsx("span",{children:"Error reading media"})}}),e.jsx("input",{type:"hidden",value:f??""})]}),e.jsxs("div",{className:"actions",children:[e.jsx(k,{variant:"outlined",onClick:_,disabled:!F.appPlugin,children:"Select"}),e.jsx(k,{variant:"outlined",onClick:w,disabled:!F.appPlugin,children:"Delete"})]})]})};export{L as default};
