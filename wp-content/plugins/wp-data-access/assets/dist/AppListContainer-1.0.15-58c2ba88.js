import{r as f,j as e,s as ps,l as n,a as ls,b as cs,A as M,g as Fe,c as ds,e as u,C as I,d as us,f as xs,h as hs,i as ms,k as gs,m as fs,n as js,o as bs,p as As,q as ys,t as Ts,u as Cs,R as se,v as ce,w as Ss,x as vs,P as Ms,y as Ie,z as Be,B as Ds,D as me,E as Is,F as ke,G as We,H as Re,I as we,J as ks,K as Ne,L as Rs,M as ws,N as Le,O as Ee,Q as Ns,S as Ls,T as Es,U as Ps,V as _s,W as zs,X as Pe,Y as Os,Z as Ae,$ as Fs}from"./main-1.0.15.js";import{B as V,A as ae,C as ve,a as Me,b as Bs}from"./useScreenSize-1.0.15-a1dd46fa.js";import{u as P,B as o,a as W,M as Ws,b as Gs,c as ue,d as qs,e as he,T as G,f as Hs,A as Ge,g as qe,h as He,i as ge,j as $s,k as Ys,l as Js,m as Vs,n as Zs,o as Ks,p as Qs,S as Xs,q as Us,r as et,s as $e,D as J,v as st,t as tt,w as rt,x as at,y as nt,z as it,C as ot,E as pt,F as lt}from"./main-1.0.15-e2ad00f6.js";import{T as ye,C as oe,s as ct,S as pe,R as dt,a as Te,B as ut,b as xt,c as ht,d as mt,e as Ce}from"./settings-1.0.15-3913c57c.js";import{C as Ye,a as Je,b as Ve,u as be}from"./useApp-1.0.15-ae446897.js";import{A as _,a as z}from"./AccordionSummary-1.0.15-ad1892ca.js";import{T as Q,F as B,I as Ze,S as Ke,a as H,A as fe,C as je,b as De}from"./TextField-1.0.15-73384817.js";import{F as gt}from"./index.esm-1.0.15-3dc3cbe3.js";import{l as _e,g as ft,M as ne}from"./MenuItem-1.0.15-cb0e11e9.js";import{L as jt}from"./ListItemIcon-1.0.15-b73952ad.js";import{s as bt,_ as de,u as At,a as yt,T as ie,c as Tt,b as Ct,I as q,P as Qe}from"./iconBase-1.0.15-5866dbfd.js";import{L as St,M as vt}from"./Menu-1.0.15-3ae4ddd1.js";import{A as xe,L as X}from"./Link-1.0.15-0c287b6b.js";import{P as Mt}from"./PremiumFeature-1.0.15-58839b47.js";import{F as le}from"./FormControlLabel-1.0.15-2f48df6c.js";import{a as Dt,b as It,c as kt,d as Rt,e as wt,f as Nt,g as Lt,h as Et,i as Pt}from"./ActionsApp-1.0.15-ae4a30d5.js";import{R as _t}from"./RadioGroup-1.0.15-f84d6091.js";import{R as ze}from"./Radio-1.0.15-7d52029a.js";import{l as zt,C as Ot,a as Ft}from"./index-1.0.15-af0a2cb5.js";import{T as Se}from"./Tabs-1.0.15-c2b715a3.js";import{F as Bt}from"./FileSaver.min-1.0.15-94852b9c.js";import{c as Wt}from"./index-1.0.15-c2b31918.js";import{S as Gt,a as qt,b as Ht}from"./Stepper-1.0.15-7dbc23a7.js";import{A as $t}from"./AppMetaData-1.0.15-1b0a1680.js";import{I as Yt}from"./InputAdornment-1.0.15-4ec316af.js";import"./Close-1.0.15-8d33e66c.js";import"./DialogContent-1.0.15-e50a43f8.js";import"./Checkbox-1.0.15-19533231.js";import"./ActionsExplorer-1.0.15-15df1613.js";import"./useSlot-1.0.15-4f7bfdbc.js";import"./Alert-1.0.15-5097a608.js";import"./index.esm-1.0.15-bb4db28d.js";import"./AlertTitle-1.0.15-cc3002eb.js";const Jt=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],Vt=s=>{const{classes:r,inset:t,primary:l,secondary:d,dense:p}=s;return Ct({root:["root",t&&"inset",p&&"dense",l&&d&&"multiline"],primary:["primary"],secondary:["secondary"]},ft,r)},Zt=bt("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(s,r)=>{const{ownerState:t}=s;return[{[`& .${_e.primary}`]:r.primary},{[`& .${_e.secondary}`]:r.secondary},r.root,t.inset&&r.inset,t.primary&&t.secondary&&r.multiline,t.dense&&r.dense]}})(({ownerState:s})=>de({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},s.primary&&s.secondary&&{marginTop:6,marginBottom:6},s.inset&&{paddingLeft:56})),Kt=f.forwardRef(function(r,t){const l=At({props:r,name:"MuiListItemText"}),{children:d,className:p,disableTypography:c=!1,inset:g=!1,primary:A,primaryTypographyProps:x,secondary:i,secondaryTypographyProps:h}=l,C=yt(l,Jt),{dense:v}=f.useContext(St);let T=A??d,j=i;const y=de({},l,{disableTypography:c,inset:g,primary:!!T,secondary:!!j,dense:v}),R=Vt(y);return T!=null&&T.type!==ie&&!c&&(T=e.jsx(ie,de({variant:v?"body2":"body1",className:R.primary,component:x!=null&&x.variant?void 0:"span",display:"block"},x,{children:T}))),j!=null&&j.type!==ie&&!c&&(j=e.jsx(ie,de({variant:"body2",className:R.secondary,color:"text.secondary",display:"block"},h,{children:j}))),e.jsxs(Zt,de({className:Tt(R.root,p),ownerState:y,ref:t},C,{children:[T,j]}))}),Qt=Kt,Xt=()=>{const s=P(r=>ps(r));return n.debug("appApps",s),s},Ut=({app:s,setIsUpdated:r})=>(n.debug(s),e.jsxs(o,{children:[e.jsx(_,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(Ye,{setIsUpdated:r})})}),e.jsx(_,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(Je,{setIsUpdated:r})})}),e.jsx(_,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(Ve,{app:s,setIsUpdated:r})})})]})),Xe=({app:s,hasErrors:r,setIsUpdated:t})=>{n.debug(s,r);const l=W();return e.jsx(Q,{type:"text",label:"App Name",error:r,fullWidth:!0,required:!0,helperText:"App name must be unique.",value:s.appName,autoFocus:!0,autoComplete:"off",onChange:d=>{l(ls({appName:d.target.value})),t&&t(!0)}})},Ue=({app:s,hasErrors:r,setIsUpdated:t})=>{n.debug(s,r);const l=W();return e.jsx(Q,{type:"text",label:"App Title",error:r,fullWidth:!0,required:!0,helperText:"App title describes the purpose of the app.",value:s.appTitle,autoComplete:"off",onChange:d=>{l(cs({appTitle:d.target.value})),t&&t(!0)}})},es=({appType:s})=>s==M.APPCONTAINER?e.jsx(o,{sx:{fontSize:"26px",display:"flex",width:"28px",justifyContent:"center",alignContent:"center",marginRight:"5px"},children:e.jsx(Ws,{})}):s==M.DATAENTRY?e.jsx(o,{sx:{fontSize:"22px",display:"flex",width:"28px",justifyContent:"center",alignContent:"center",marginRight:"5px"},children:e.jsx(Gs,{})}):e.jsx(o,{sx:{fontSize:"20px",display:"flex",width:"28px",justifyContent:"center",alignContent:"center",marginRight:"5px"},children:e.jsx(gt,{})}),ss=({app:s,isNew:r,setIsUpdated:t})=>{n.debug(s);const l=W(),d=Fe(),p=r?"Select App Type *":"App Type *";return e.jsxs(B,{fullWidth:!0,children:[e.jsx(Ze,{variant:"outlined",children:p}),e.jsxs(Ke,{MenuProps:{id:"pp-select-menu"},label:p,value:s.appType,disabled:r!==!0&&s.appType==M.APPCONTAINER,onChange:c=>{l(ds({appType:c.target.value})),t&&t(!0)},sx:{"& .MuiSelect-select":{display:"flex",alignItems:"center"}},children:[...d.map(c=>{let g=c.id===M.DATATABLE||c.id===M.DATAENTRY||c.id===M.APPCONTAINER;return r!==!0&&c.id===M.APPCONTAINER&&(g=!1),e.jsxs(ne,{value:c.id,disabled:!g,children:[e.jsx(jt,{sx:{minWidth:"unset"},children:e.jsx(es,{appType:c.id})}),e.jsx(Qt,{children:c.text})]})})]}),e.jsxs(H,{children:["Select ",e.jsx("strong",{children:"Data Table"})," to create a read-only app, or ",e.jsx("strong",{children:"Data Administration"})," to enable transactions. To create an app that contains one or more other apps, select ",e.jsx("strong",{children:"Data App"}),"."]})]})},er=({app:s})=>{n.debug(s);const[r,t]=f.useState(!1),[l,d]=f.useState(void 0),p=()=>{switch(l){case"form":return"Reset Form Builder?";case"theme":return"Reset Theme?";default:return"Reset Table Builder?"}};return e.jsxs(e.Fragment,{children:[e.jsxs(_,{disableGutters:!0,children:[e.jsx(z,{expandIcon:e.jsx(ue,{}),children:"Reset"}),e.jsx(xe,{children:e.jsxs(B,{sx:{display:"grid",gridGap:"20px"},children:[e.jsx(V,{variant:"contained",color:"primary",onClick:()=>{d(ye.TABLE),t(!0)},children:"Reset Table Builder"}),e.jsx(V,{variant:"contained",color:"primary",onClick:()=>{d(ye.FORM),t(!0)},children:"Reset Form Builder"}),e.jsx(V,{variant:"contained",color:"primary",onClick:()=>{d(ye.THEME),t(!0)},children:"Reset Theme"}),e.jsxs(H,{sx:{display:"inline-grid",gridTemplateColumns:"20px auto",gridGap:"5px",alignItems:"center","& svg":{fontSize:"20px"}},error:!0,children:[e.jsx(qs,{}),"A reset cannot be undone!"]})]})})]}),e.jsx(oe,{title:p(),message:"Are you sure? This action cannot be undone!",open:r,setOpen:t,onConfirm:()=>{l!==void 0&&ct(s.appDbId,s.appCntId,l,null,null,c=>{if(c!=null&&c.code&&(c==null?void 0:c.message)!==void 0)switch(c.code){case"ok":u(c.message,{variant:"success"});break;case"info":u(c.message,{variant:"info"});break;default:u(c.message??I.contactSupport,{variant:"error"})}else n.error(c),u(I.contactSupport,{variant:"error"})},c=>{n.error("error",c),u(c??I.contactSupport,{variant:"error"})})}})]})},ts=()=>{const s=P(r=>us(r));return n.debug("appMetaData",s),s},sr=()=>{const s=P(r=>xs());return n.debug("appLanguage",s),s},rs=({app:s,setIsUpdated:r})=>{n.debug(s);const t=W();ts();const l=sr(),d=P(g=>hs(g));n.debug("updateSiteLanguage",d),f.useEffect(()=>{const g={appLanguage:ms.code};t(gs(g))},[]);const[p,c]=f.useState(!1);return e.jsxs(o,{sx:{width:"100%"},children:[e.jsxs(B,{fullWidth:!0,disabled:!0,children:[e.jsx(Ze,{variant:"outlined",children:"App Language"}),e.jsxs(Ke,{MenuProps:{id:"pp-select-menu"},label:"App Language",value:l,onChange:g=>{},children:[...fs.map(g=>e.jsx(ne,{value:g.code,children:g.language},g.code))]}),e.jsx(H,{children:"Selected app language is applied to all (master and detail) tables and forms."})]}),!1,e.jsx(B,{children:e.jsxs(H,{component:"div",sx:{marginLeft:0},children:[e.jsx(o,{sx:{marginTop:"20px"},children:e.jsxs(X,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>c(!p),children:[e.jsx(he,{}),"Which app information is localized?"]})}),p&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{sx:{marginTop:"20px"},children:[e.jsx("strong",{children:"Information provided in the selected app language:"}),e.jsxs("ul",{style:{listStyle:"disc",padding:"0 40px"},children:[e.jsx("li",{children:"Tooltips"}),e.jsx("li",{children:"Field labels"}),e.jsx("li",{children:"Field hints"}),e.jsx("li",{children:"Info and success messages"}),e.jsx("li",{children:"Most error messages"})]})]}),e.jsxs(o,{sx:{marginTop:"20px"},children:[e.jsx("strong",{children:"Information not provided in the selected language:"}),e.jsxs("ul",{style:{listStyle:"disc",padding:"0 40px"},children:[e.jsx("li",{children:"Builders, Wizards and Managers are provided in English"}),e.jsx("li",{children:"Database and server errors are not translated"})]})]}),e.jsx(o,{sx:{marginTop:"20px"},children:"If you discover any translation errors, please let us know. We are committed to improving our translations."})]})]})}),e.jsx(Mt,{})]})},tr=()=>{const s=P(r=>js(r));return n.debug("appFullscreen",s),s},rr=()=>{const s=P(r=>bs(r));return n.debug("appSafeMode",s),s},ar=({app:s,setIsUpdated:r})=>{n.debug(s);const t=W(),l=tr(),d=rr();return e.jsxs(e.Fragment,{children:[e.jsx(le,{control:e.jsx(pe,{checked:l,onChange:(p,c)=>{t(As({fullScreen:c})),r&&r(!0),p.stopPropagation()}}),label:"Enable full screen support",labelPlacement:"end"}),e.jsx(B,{fullWidth:!0,children:e.jsx(H,{children:"Adds an icon to the app toolbar, allowing the user to switch to full-screen mode."})}),e.jsx(le,{control:e.jsx(pe,{checked:d,onChange:(p,c)=>{t(ys({safeMode:c})),r&&r(!0),p.stopPropagation()}}),label:"Enable safe mode",labelPlacement:"end"}),e.jsx(B,{fullWidth:!0,children:e.jsx(H,{children:"Disables all custom code, including hooks and computed code fields."})})]})},nr=({app:s,setIsUpdated:r})=>(n.debug(s),e.jsxs(o,{children:[e.jsx(_,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(Xe,{app:s,hasErrors:!1,setIsUpdated:r})})}),e.jsx(_,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(Ue,{app:s,hasErrors:!1,setIsUpdated:r})})}),e.jsx(_,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(ss,{app:s,setIsUpdated:r})})}),e.jsx(_,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(rs,{app:s,setIsUpdated:r})})}),e.jsxs(_,{disableGutters:!0,children:[e.jsx(z,{expandIcon:e.jsx(ue,{}),children:"Settings"}),e.jsx(xe,{children:e.jsx(ar,{app:s,setIsUpdated:r})})]}),e.jsx(er,{app:s})]})),as=()=>{const s=P(r=>Ts(r));return n.debug("apps",s),s},ns=({app:s,setIsUpdated:r})=>{const t=W(),[l,d]=f.useState(!1),p=as(),c=p.filter(x=>s.appDbId!==x.appId&&x.appType!=M.APPCONTAINER),g=[];s.appApps.map(x=>{const i=p.filter(h=>h.appId===x);i.length===1&&g.push(i[0])});const A=x=>x.appName+(l?" ("+x.appTitle+")":"");return e.jsxs(B,{sx:{width:"100%",marginTop:"8px"},children:[e.jsx(fe,{multiple:!0,options:c,value:g,disableCloseOnSelect:!0,getOptionLabel:x=>A(x),onChange:(x,i)=>{t(Cs({appApps:i.map(h=>h.appId)})),r&&r(!0),x.stopPropagation()},renderInput:x=>e.jsx(Q,{...x,label:"Apps"}),renderTags:(x,i)=>x.map((h,C)=>{const{key:v,...T}=i({index:C});return e.jsx(je,{variant:"outlined",label:A(h),...T},v)})}),e.jsxs(H,{component:"div",sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"Apps will be added in the order they are entered here."}),e.jsx(le,{sx:{"& span.MuiFormControlLabel-label":{fontSize:"0.75rem"}},control:e.jsx(pe,{checked:l,onChange:x=>{d(!l),x.stopPropagation()}}),label:"Show title",labelPlacement:"end"})]})]})},ir=({app:s,setIsUpdated:r})=>e.jsx(_,{disableGutters:!0,children:e.jsx(z,{children:e.jsx(ns,{app:s,setIsUpdated:r})})}),is=({setIsUpdated:s})=>{const r=W(),t=be(),l=ts(),d=f.useMemo(()=>{const i=[];if((l==null?void 0:l.roles)!==void 0)for(const h in l.roles)i.push({key:h,value:l.roles[h]});return i},[l.roles]);n.debug(d);const p=f.useMemo(()=>{const i=[];if((l==null?void 0:l.users)!==void 0)for(const h in l.users)i.push({key:h,value:l.users[h]});return i},[l.users]);n.debug(p);const c=f.useMemo(()=>d.filter(i=>t.appRestApi.authorized_roles.includes(i.key)),[t.appRestApi.authorized_roles,d]),g=f.useMemo(()=>p.filter(i=>t.appRestApi.authorized_users.includes(i.key)),[t.appRestApi.authorized_users,p]),[A,x]=f.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("fieldset",{className:"pp-fieldset",style:{padding:"20px"},children:[e.jsx("legend",{children:"Authorization"}),e.jsx(B,{sx:{width:"100%"},children:e.jsxs(_t,{children:[e.jsxs(De,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(ze,{checked:t.appRestApi.authorization===se.AUTHORIZED,onChange:i=>{r(ce({restApiActions:{...t.appRestApi,authorization:se.AUTHORIZED}})),s&&s(!0),i.stopPropagation()}}),"Authorized access only"]}),e.jsxs(o,{sx:{display:"grid",gridGap:"10px",margin:"20px 20px 15px 42px"},children:[e.jsx(fe,{multiple:!0,options:d,disableCloseOnSelect:!0,getOptionLabel:i=>i.value,value:c,onChange:(i,h)=>{r(ce({restApiActions:{...t.appRestApi,authorized_roles:h.map(C=>C.key)}})),s&&s(!0),i.stopPropagation()},renderInput:i=>e.jsx(Q,{...i,label:"Roles"}),renderTags:(i,h)=>i.map((C,v)=>{const{key:T,...j}=h({index:v});return e.jsx(je,{variant:"outlined",label:C.value,...j},T)})}),e.jsx(fe,{multiple:!0,options:p,disableCloseOnSelect:!0,getOptionLabel:i=>i.value,value:g,onChange:(i,h)=>{r(ce({restApiActions:{...t.appRestApi,authorized_users:h.map(C=>C.key)}})),s&&s(!0),i.stopPropagation()},renderInput:i=>e.jsx(Q,{...i,label:"Users"}),renderTags:(i,h)=>i.map((C,v)=>{const{key:T,...j}=h({index:v});return e.jsx(je,{variant:"outlined",label:C.value,...j},T)})})]}),e.jsxs(De,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(ze,{checked:t.appRestApi.authorization===se.ANONYMOUS,onChange:i=>{r(ce({restApiActions:{...t.appRestApi,authorization:se.ANONYMOUS}})),s&&s(!0),i.stopPropagation()}}),"Anonymous access"]})]})})]}),e.jsx(B,{children:e.jsxs(H,{component:"div",sx:{marginLeft:0},children:[e.jsx(o,{sx:{marginTop:"25px"},children:e.jsxs(X,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>x(!A),children:[e.jsx(he,{}),"What is the difference between authorized and anonymous access?"]})}),A&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{sx:{marginTop:"20px"},children:[e.jsx("strong",{children:"Authorized access:"}),e.jsxs("ul",{style:{listStyle:"disc",padding:"0 40px"},children:[e.jsx("li",{children:"Users with the selected roles can access this app"}),e.jsx("li",{children:"Selected users can access this app"}),e.jsx("li",{children:"Other registered users cannot access this app"}),e.jsx("li",{children:"Anonymous users cannot access this app"})]})]}),e.jsxs(o,{sx:{marginTop:"20px"},children:[e.jsx("strong",{children:"Anonymous access:"}),e.jsx("ul",{style:{listStyle:"disc",padding:"0 40px"},children:e.jsx("li",{children:"Any user can access this app"})})]}),e.jsx(o,{sx:{marginTop:"20px"},children:"App authorization is applied to both back-end and front-end usage. Back-end access is restricted to registered users only. A Data Table app displayed on the front-end typically allows anonymous access, enabling visitors to view the table. In contrast, Data Management apps usually require authorized access to prevent unauthorized users from altering table data."})]})]})})]})},or=({app:s,setIsUpdated:r})=>{n.debug(s);const t=W(),[l,d]=f.useState(!1);return e.jsxs(o,{sx:{display:"grid",gridGap:"30px"},children:[e.jsxs(o,{children:[e.jsx(o,{children:e.jsx(le,{control:e.jsx(pe,{checked:s.appAddToMenu,onChange:(p,c)=>{t(Ss({appAddToMenu:c})),r&&r(!0),p.stopPropagation()}}),label:"Add App to WordPress dashboard menu",labelPlacement:"end"})}),e.jsx(B,{children:e.jsxs(H,{component:"div",children:[e.jsx(o,{children:e.jsxs(X,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>d(!l),children:[e.jsx(he,{}),"What is a WordPress dashboard menu?"]})}),l&&e.jsx(o,{sx:{marginTop:"20px"},children:"The WordPress dashboard provides a navigation menu with options to navigate to built-in or custom pages. Enabling this option adds a menu item to the WordPress dashboard for all authorized users, allowing easy access to this app."})]})})]}),s.appAddToMenu&&e.jsx(Q,{type:"text",label:"Title",fullWidth:!0,required:!0,helperText:"Title shown in WordPress dashboard menu.",value:s.appMenuTitle,autoComplete:"off",onChange:p=>{t(vs({appMenuTitle:p.target.value})),r&&r(!0),p.stopPropagation()}})]})},pr=({app:s,setIsUpdated:r})=>{n.debug(s);const t=()=>`[wpda_app app_id="${s.appDbId}"${l?' feedback="true"':""}${g?' builders="false"':""}]`,[l,d]=f.useState(!1),[p,c]=f.useState(!1),[g,A]=f.useState(!1),[x,i]=f.useState(!1),[h,C]=f.useState(t());return f.useEffect(()=>{C(t())},[l,g]),e.jsxs(o,{sx:{display:"grid",gridGap:"20px"},children:[e.jsxs(o,{children:[e.jsxs(De,{children:["App short code",e.jsx(o,{sx:{marginLeft:"5px",display:"inline-block"},children:e.jsx(zt.CopyToClipboard,{text:h,onCopy:()=>{u("Shortcode was copied to your clipboard",{variant:"info"})},children:e.jsx(G,{title:"Copy shortcode to clipboard",children:e.jsx(q,{children:e.jsx(Hs,{})})})})})]}),e.jsx(o,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center","& pre":{backgroundColor:"#ccc",padding:"4px"}},children:e.jsx("pre",{children:h})})]}),e.jsx(o,{children:e.jsxs(B,{children:[e.jsx(le,{control:e.jsx(pe,{checked:l,onChange:(v,T)=>{d(T),r&&r(!0),v.stopPropagation()}}),label:"Feedback",labelPlacement:"end"}),e.jsxs(H,{component:"div",children:[e.jsxs(X,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>{c(!p)},children:[e.jsx(he,{}),"Show authorization and usage errors"]}),p&&e.jsx(o,{sx:{marginTop:"20px"},children:"Authorization and usage errors are hidden by default to prevent errors from appearing on front-end pages for unauthorized users. If you want to display authorization and usage errors, enable feedback."})]})]})}),e.jsx(o,{children:e.jsxs(B,{children:[e.jsx(le,{control:e.jsx(pe,{checked:g,onChange:(v,T)=>{A(T),r&&r(!0),v.stopPropagation()}}),label:"Disable builders on front-end",labelPlacement:"end"}),e.jsxs(H,{component:"div",children:[e.jsxs(X,{sx:{textDecoration:"none",cursor:"pointer",display:"inline-flex","& svg":{fontSize:"1rem",marginRight:"2px"}},onClick:()=>{i(!x)},children:[e.jsx(he,{}),"Disables builder access for administrators"]}),x&&e.jsx(o,{sx:{marginTop:"20px"},children:"Builder access is automatically enabled on front-end pages for administrators, allowing them to change app settings directly. Disabling builder access will remove all Table Builder and Form Builder icons from these pages. Please note that anonymous users and non-admin users cannot see these builder icons and have no access to app settings."})]})]})})]})},lr=({app:s,setIsUpdated:r})=>(n.debug(s),e.jsxs(o,{children:[e.jsxs(_,{disableGutters:!0,children:[e.jsx(z,{expandIcon:e.jsx(ue,{}),children:"Authorize Roles & Users"}),e.jsx(xe,{children:e.jsx(is,{setIsUpdated:r})})]}),e.jsxs(_,{disableGutters:!0,children:[e.jsx(z,{expandIcon:e.jsx(ue,{}),children:"Back-end Access"}),e.jsx(xe,{children:e.jsx(or,{app:s,setIsUpdated:r})})]}),e.jsxs(_,{disableGutters:!0,children:[e.jsx(z,{expandIcon:e.jsx(ue,{}),children:"Front-end Access"}),e.jsx(xe,{children:e.jsx(pr,{app:s})})]})]})),cr=({appDbId:s})=>{var R,O;n.debug(s);const r=W(),t=be(),l=((R=ae)==null?void 0:R.palette.mode)===Ms.LIGHT?(O=ae)==null?void 0:O.palette.primary.main:"",[d,p]=f.useState(!1);n.debug(d);const[c,g]=f.useState(!1);n.debug(c);const A=()=>{r(Be({}))},x=()=>{d?g(!0):A()},i=()=>{if(!t.appName)return u("App name is required",{variant:"error"}),!1;if(!t.appTitle)return u("App title is required",{variant:"error"}),!1;if(t.appType==M.APPCONTAINER)t.appApps.length===0&&u("No apps added",{variant:"info"});else{if(!t.appDatabase)return u("Database is required",{variant:"error"}),!1;if(!t.appTable)return u("Table is required",{variant:"error"}),!1;if(t.appColumns.filter(b=>b.isSelected).length===0)return u("At least one column must be selected",{variant:"error"}),!1}return!0},h=()=>{i()&&Dt(t,b=>{if(n.debug(b),b!=null&&b.code&&(b==null?void 0:b.message)!==void 0)switch(b.code){case"ok":u(b.message,{variant:"success"}),r(me({}));break;case"info":u(b.message,{variant:"info"});break;default:n.error(b),u(b.message??I.contactSupport,{variant:"error"})}else n.error(b),u(I.contactSupport,{variant:"error"})},b=>{n.error("error",b),u(b??I.contactSupport,{variant:"error"})})},C=()=>{i()&&(h(),A())},v=b=>{r(Ds({anchor:b}))},[T,j]=f.useState("1"),y=(b,$)=>{j($)};return e.jsxs(e.Fragment,{children:[e.jsxs(dt,{closeDrawer:x,children:[e.jsx(Ge,{position:"static",elevation:4,sx:{borderRadius:0},children:e.jsxs(qe,{className:"pp-setting-toolbar",sx:{borderRadius:0},children:[e.jsxs(o,{sx:{flexGrow:1},children:[e.jsx(ie,{variant:"h5",noWrap:!0,component:"div",className:"unselectable",sx:{display:{xs:"none",sm:"block"},paddingLeft:"6px"},children:"Manage App"}),e.jsx(ie,{sx:{fontSize:"10px",display:{xs:"none",sm:"block"},paddingLeft:"10px"},children:t.appName})]}),e.jsx(Te,{title:"Dock to left",position:"bottom",children:e.jsx(q,{onClick:()=>{v(Ie.LEFT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(ut,{})})}),e.jsx(Te,{title:"Dock to right",position:"bottom",children:e.jsx(q,{onClick:()=>{v(Ie.RIGHT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(xt,{})})}),e.jsx(Te,{title:"Close",position:"bottom",children:e.jsx(q,{onClick:x,size:"large",color:"inherit",sx:{fontSize:"1.4em"},children:e.jsx(He,{})})})]})}),e.jsx(ve,{className:"pp-settings-container",children:e.jsx(Me,{sx:{padding:0,margin:0},children:e.jsxs(ht,{value:T,children:[e.jsxs(mt,{variant:"fullWidth",textColor:"primary",onChange:y,sx:{width:"100%",height:"80px",padding:0,margin:0,backgroundColor:"rgb(242, 242, 242)"},children:[e.jsx(Se,{label:"App Info",value:"1",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(Se,{label:t.appType==M.APPCONTAINER?"Apps":"Data Source",value:"2",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(Se,{label:"Access",value:"3",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}})]}),e.jsxs(o,{sx:{margin:0,padding:0,overflowY:"auto",height:"calc(100vh - 250px)","& > div.MuiTabPanel-root":{padding:0}},children:[e.jsx(Ce,{value:"1",children:e.jsx(nr,{app:t,setIsUpdated:p})}),e.jsx(Ce,{value:"2",children:t.appType==M.APPCONTAINER?e.jsx(ir,{app:t,setIsUpdated:p}):e.jsx(Ut,{app:t,setIsUpdated:p})}),e.jsx(Ce,{value:"3",children:e.jsx(lr,{app:t,setIsUpdated:p})})]})]})})}),e.jsx(ve,{className:"pp-setting-footer",sx:{borderRadius:0,backgroundColor:l},children:e.jsxs(Me,{className:"pp-setting-footer-buttons",sx:{borderRadius:0},children:[e.jsx(V,{variant:"outlined",className:"footer_action_button_apply",onClick:h,children:"Apply"}),e.jsx(V,{variant:"outlined",className:"footer_action_button",onClick:C,children:"OK"}),e.jsx(V,{variant:"outlined",className:"footer_action_button",onClick:x,children:"Cancel"})]})})]}),e.jsx(oe,{title:"Close App Manager?",message:"All uncommitted changes will be lost!",open:c,setOpen:g,onConfirm:()=>{A()},onKeep:()=>{A()}})]})},dr=()=>{const s=P(r=>Is(r));return n.debug("showAppStructure",s),s},Oe=({app:s,density:r})=>{var b,$,Z,K;n.debug(s);const t=W(),[l,d]=f.useState(!1),[p,c]=f.useState(!1),[g,A]=f.useState(!1),x=a=>{let E={};try{E=JSON.parse(a.app_settings)}catch(k){E.rest_api={authorization:se.AUTHORIZED,authorized_roles:[],authorized_users:[]},n.error("Invalid JSON - app settings"),n.error(k),u("Invalid JSON, check console",{variant:"error"})}return E},i=a=>{It(a,E=>{var Y,te,m,S,F,U,re,w;const k=E==null?void 0:E.data;if(n.debug("response data",k),k.app&&k.app.app&&Array.isArray(k.app.app)&&k.app.container&&Array.isArray(k.app.container)&&k.app.apps&&Array.isArray(k.app.apps)){const N=k.app.app[0];if(n.debug(N),N.app_type===M.APPCONTAINER.toString()){const D=x(N),ee=k.app.apps;n.debug(ee),t(Re({appDbId:a,appId:we(a),appName:N.app_name,appTitle:N.app_title,appType:N.app_type,appCntId:0,appCntSeqNr:0,appDatabase:null,appTable:null,appColumns:[],appRelationTable:null,appRelationColumns:[],appRestApi:D==null?void 0:D.rest_api,appAddToMenu:N.app_add_to_menu!=="0",appMenuTitle:((Y=D==null?void 0:D.settings)==null?void 0:Y.app_menu_title)??N.app_title,appMetaData:k,appLanguage:(te=D==null?void 0:D.settings)==null?void 0:te.app_language,fullScreen:((m=D==null?void 0:D.settings)==null?void 0:m.app_fullscreen)??!0,safeMode:((S=D==null?void 0:D.settings)==null?void 0:S.app_safe_mode)??!1,appApps:ee}))}else{const D=k.app.container[0];n.debug(D);let ee=[];try{ee=JSON.parse(D.cnt_cls)}catch(os){n.error("Invalid JSON - app columns"),n.error(os),u("Invalid JSON, check console",{variant:"error"})}const L=x(N);t(Re({appDbId:a,appId:we(a),appName:N.app_name,appTitle:N.app_title,appType:N.app_type,appCntId:D.cnt_id,appCntSeqNr:D.cnt_seq_nr,appDatabase:D.cnt_dbs,appTable:D.cnt_tbl,appColumns:ee,appRelationTable:null,appRelationColumns:[],appRestApi:L==null?void 0:L.rest_api,appAddToMenu:N.app_add_to_menu!=="0",appMenuTitle:((F=L==null?void 0:L.settings)==null?void 0:F.app_menu_title)??N.app_title,appMetaData:k,appLanguage:(U=L==null?void 0:L.settings)==null?void 0:U.app_language,fullScreen:((re=L==null?void 0:L.settings)==null?void 0:re.app_fullscreen)??!0,safeMode:((w=L==null?void 0:L.settings)==null?void 0:w.app_safe_mode)??!1}))}}else u(I.contactSupport,{variant:"error"})},E=>{n.error("error",E),u(E??I.contactSupport,{variant:"error"})})},h=()=>{kt(s.appId,a=>{if(n.debug(a),a!=null&&a.code&&(a==null?void 0:a.message)!==void 0)switch(a.code){case"ok":u(a.message,{variant:"success"}),t(me({}));break;case"info":u(a.message,{variant:"info"});break;default:n.error(a),u(a.message??I.contactSupport,{variant:"error"})}else n.error(a),u(I.contactSupport,{variant:"error"});d(!1)},a=>{n.error("error",a),u(a??I.contactSupport,{variant:"error"}),d(!1)})},C=()=>{Rt(s.appId,a=>{n.debug(a),a!=null&&a.code&&(a==null?void 0:a.message)!==void 0?a.data.data?Bt(new Blob([a.data.data],{type:"text/json;charset=utf-8"}),"wpda-export-"+s.appName+".sql"):(n.error(a),u(a.message??I.contactSupport,{variant:"error"})):(n.error(a),u(I.contactSupport,{variant:"error"})),d(!1)},a=>{n.error("error",a),u(a??I.contactSupport,{variant:"error"}),d(!1)})},v=()=>{wt(s.appId,a=>{if(n.debug(a),a!=null&&a.code&&(a==null?void 0:a.message)!==void 0)switch(a.code){case"ok":u(a.message,{variant:"success"}),t(me({}));break;case"info":u(a.message,{variant:"info"});break;default:n.error(a),u(a.message??I.contactSupport,{variant:"error"})}else n.error(a),u(I.contactSupport,{variant:"error"});A(!1)},a=>{n.error("error",a),u(a??I.contactSupport,{variant:"error"}),A(!1)})},T=ge("(max-width:700px)"),j=ge("(max-width:900px)"),[y,R]=f.useState(null),O=!!y;return e.jsxs(e.Fragment,{children:[e.jsxs(o,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center",padding:r==="small"?"8px 8px 8px 12px":r==="medium"?"16px":"24px",...j&&{".pp-row-actions":{width:0}},"&:hover":{".pp-row-title":{display:j?"inline-block":"none"},".pp-row-actions":{visibility:j?"hidden":"visible"}}},children:[e.jsxs(o,{sx:{display:"grid",gridTemplateColumns:"auto auto",alignItems:"center"},children:[e.jsxs(o,{sx:{width:"100%",display:"grid",gridTemplateColumns:"auto 1fr",gridGap:r==="small"?"3px":r==="medium"?"6px":"9px",justifyContent:"center",alignItems:"center"},children:[e.jsx(es,{appType:s.appType}),e.jsxs(o,{sx:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},children:[s.appName,e.jsxs(o,{className:"pp-row-title",sx:{display:"inline-block",marginLeft:"5px",fontSize:"80%"},children:["−",e.jsx(o,{sx:{display:"inline-block",width:"5px"}}),s.appTitle," (App ID: ",s.appId,")"]})]})]}),e.jsxs(o,{sx:{display:"grid",visibility:"hidden",gridTemplateColumns:"auto auto auto auto",gridGap:"10px",marginLeft:"10px",alignItems:"center"},className:"pp-row-actions",children:[e.jsx(o,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(G,{title:"Manage App",children:e.jsx(X,{sx:{cursor:"pointer"},underline:"none",onClick:a=>{i(s.appId),a.preventDefault(),a.stopPropagation()},children:"Manage"})}),e.jsx(o,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(G,{title:"Run & Build App",children:e.jsx(X,{sx:{cursor:"pointer"},underline:"none",onClick:a=>{t(ke({isActive:!0,appDbId:s.appId})),a.preventDefault(),a.stopPropagation()},children:"Run & Build"})})]})]}),e.jsxs(o,{sx:{display:"grid",gridTemplateColumns:"auto auto auto auto auto auto auto",justifyContent:T?"end":"space-evenly",alignItems:"center"},children:[e.jsx(o,{sx:{paddingRight:"10px"},children:T?"":We(s.appType)}),e.jsx(G,{title:"Manage App",children:e.jsx(q,{sx:{color:(b=ae)==null?void 0:b.palette.primary.main},onClick:a=>{i(s.appId),a.preventDefault(),a.stopPropagation()},children:e.jsx($s,{})})}),e.jsx(G,{title:"Run & Build App",children:e.jsx(q,{sx:{color:($=ae)==null?void 0:$.palette.primary.main},onClick:a=>{t(ke({isActive:!0,appDbId:s.appId})),a.preventDefault(),a.stopPropagation()},children:e.jsx(Ys,{})})}),e.jsx(G,{title:"More App actions",children:e.jsx(q,{sx:{color:(Z=ae)==null?void 0:Z.palette.primary.main},onClick:a=>{R(a.currentTarget),a.preventDefault(),a.stopPropagation()},children:e.jsx(Js,{})})}),e.jsxs(vt,{id:"pp-app-builder-more-actions",anchorEl:y,open:O,onClose:()=>{R(null)},MenuListProps:{"aria-labelledby":"pp-app-builder-more-actions"},sx:{zIndex:9999999999},anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsxs(ne,{onClick:a=>{R(null),d(!0),a.preventDefault(),a.stopPropagation()},children:[e.jsx(Vs,{}),e.jsx("span",{style:{margin:"0 10px"},children:"Copy"})]}),e.jsxs(ne,{onClick:a=>{R(null),c(!0),a.preventDefault(),a.stopPropagation()},children:[e.jsx(Zs,{}),e.jsx("span",{style:{margin:"0 10px"},children:"Export"})]}),e.jsx(Ot,{text:`[wpda_app app_id="${s.appId}"]`,onCopy:()=>{u(`Shortcode [wpda_app app_id="${s.appId}"] was copied to your clipboard`,{variant:"info"})},children:e.jsxs(ne,{onClick:a=>{R(null),a.preventDefault(),a.stopPropagation()},children:[e.jsx(Ks,{}),e.jsx("span",{style:{margin:"0 10px"},children:"Shortcode"})]})}),e.jsxs(ne,{onClick:a=>{R(null),A(!0),a.preventDefault(),a.stopPropagation()},sx:{color:(K=ae)==null?void 0:K.palette.error.main},children:[e.jsx(Qs,{}),e.jsx("span",{style:{margin:"0 10px"},children:"Delete"})]})]})]})]}),l&&e.jsx(oe,{title:"Please confirm",message:"Copy this app including all containers?",open:l,setOpen:d,onConfirm:()=>h()}),p&&e.jsx(oe,{title:"Please confirm",message:"Export this app including all containers?",open:p,setOpen:c,onConfirm:()=>C()}),g&&e.jsx(oe,{title:"Delete App?",message:"Are you sure you want to delete app "+s.appName+"? This action cannot be undone!",open:g,setOpen:A,onConfirm:()=>v()})]})},ur=({apps:s,appApps:r,search:t,types:l,isLoading:d,density:p})=>{n.debug(s,r,t,l);const c=dr(),g=i=>{if(l.length===0&&t.trim()==="")return!0;if(c&&r[i.appId]){let h=!1;if(r[i.appId].map(C=>{const v=s.filter(T=>T.appId==C)[0];Ne(v.appName+" "+v.appTitle,t)&&(h=!0),l.filter(T=>T.id===Number(v.appType)).length>0&&(h=!0)}),h)return!0}return!(!Ne(i.appName+" "+i.appTitle,t)||l.length>0&&l.filter(h=>h.id===Number(i.appType)).length===0)},A=s.filter(i=>g(i)?i:null),x=i=>r[i]?e.jsxs(o,{sx:{marginLeft:p==="small"?"48px":p==="medium"?"56px":"64px","& > div":{borderTop:"1px solid #ddd",borderRadius:"0 !important"}},children:[...r[i].map(h=>{const C=s.filter(v=>v.appId==h);return C.length>0?e.jsx(Oe,{app:C[0],density:p}):null})]}):null;return e.jsx(Qe,{elevation:4,children:e.jsxs(o,{sx:{backgroundColor:"#fff",borderRadius:"4px","& .MuiBox-root:first-of-type":{borderTopLeftRadius:"4px",borderTopRightRadius:"4px"},"& .MuiBox-root:hover":{backgroundColor:"rgb(242, 242, 242)"},"& .pp-app-details:nth-of-type(odd)":{backgroundColor:"#f9f9f9"}},children:[...s.map(i=>{const h=g(i);return c&&Object.keys(r).filter(C=>r[C].includes(Number(i.appId))).length>0?null:e.jsxs(o,{className:"pp-app-details",sx:{visibility:h?"visible":"hidden",position:h?"relative":"fixed",borderTop:"1px solid #ddd","&:first-of-type":{borderTop:"unset"}},children:[e.jsx(Oe,{app:i,density:p}),c&&x(i.appId)]})}),A.length===0&&e.jsx(o,{sx:{padding:"35px",borderRadius:"4px"},children:d?e.jsx(Xs,{title:"Loading apps...",align:ks.LEFT}):e.jsx(o,{children:"No apps found"})})]})})},xr=({setMode:s})=>{const r=W(),t=be(),l=()=>t.appType===M.APPCONTAINER,d=l()?["App info","Apps","Authorization"]:["App info","Data source","Authorization"],[p,c]=f.useState(0);f.useEffect(()=>{let j=null;switch(t.appType){case M.DATATABLE:j=se.ANONYMOUS;break;case M.DATAENTRY:case M.MASTERDETAIL:case M.REGISTRATION:case M.UPDATEFORM:case M.APPCONTAINER:j=se.AUTHORIZED;break}j!==null?r(ce({restApiActions:Rs(j)})):u(I.contactSupport,{variant:"error"})},[t.appType]);const[g,A]=f.useState({appName:!1,appTitle:!1,appDatabase:!1,appTable:!1,appColumns:!1});n.debug(g);const x=()=>{const j=Wt(ws);j.table.transactions.insert=Number(t.appType)===M.DATAENTRY||Number(t.appType)===M.MASTERDETAIL||Number(t.appType)===M.REGISTRATION,j.table.transactions.update=Number(t.appType)===M.DATAENTRY||Number(t.appType)===M.MASTERDETAIL||Number(t.appType)===M.UPDATEFORM,j.table.transactions.delete=Number(t.appType)===M.DATAENTRY||Number(t.appType)===M.MASTERDETAIL,Nt(t,j,y=>{if(n.debug(y),y!=null&&y.code&&(y==null?void 0:y.message)!==void 0)switch(y.code){case"ok":u(y.message,{variant:"success"}),s(J.TABLE),r(me({}));break;case"info":u(y.message,{variant:"info"});break;default:n.error(y),u(y.message??I.contactSupport,{variant:"error"})}else n.error(y),u(I.contactSupport,{variant:"error"})},y=>{n.error("error",y),u(y??I.contactSupport,{variant:"error"})}),t.updateSiteLanguage&&t.appLanguage!==void 0&&Lt(t.appLanguage,()=>{},()=>{})},i=()=>{var y,R;let j=!0;if(p===0){let O=!1,b=!1;t.appName.trim()===""&&(u("App name is required",{variant:"error"}),O=!0,j=!1),t.appTitle.trim()===""&&(u("App title is required",{variant:"error"}),b=!0,j=!1),A({...g,appName:O,appTitle:b})}if(p===1){let O=!1,b=!1,$=!1;l()?t.appApps.length===0&&u("No apps added",{variant:"info"}):(((y=t.appDatabase)==null?void 0:y.trim())===""&&(u("Database is required",{variant:"error"}),O=!0,j=!1),((R=t.appTable)==null?void 0:R.trim())===""&&(u("Table is required",{variant:"error"}),b=!0,j=!1),t.appColumns.filter(Z=>Z.isSelected===!0).length===0&&(u("No columns selected",{variant:"error"}),$=!0,j=!1)),A({...g,appDatabase:O,appTable:b,appColumns:$})}return p===d.length-1&&x(),n.debug(j),j},h=()=>e.jsxs(o,{sx:{textAlign:"right",display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[p>0?e.jsx(V,{variant:"outlined",size:"medium",sx:{width:"160px",marginRight:"10px"},onClick:()=>{c(p-1)},startIcon:e.jsx(Us,{}),children:e.jsx(o,{children:"Back"})}):e.jsx(o,{}),e.jsx(V,{variant:"contained",size:"medium",sx:{width:"160px"},onClick:()=>{i()&&p<d.length-1&&c(p+1)},startIcon:p>=d.length-1&&e.jsx(et,{}),endIcon:p<d.length-1&&e.jsx($e,{}),children:e.jsx(o,{children:p<d.length-1?"Next":"Finish"})})]}),C=()=>e.jsxs(e.Fragment,{children:[e.jsx(Xe,{app:t,hasErrors:g.appName}),e.jsx(Ue,{app:t,hasErrors:g.appName}),e.jsx(rs,{app:t}),h()]}),v=()=>l()?e.jsxs(e.Fragment,{children:[e.jsx(ns,{app:t}),h()]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{}),e.jsx(o,{sx:{display:t.appDatabase?"block":"none"},children:e.jsx(Je,{})}),e.jsx(o,{sx:{display:t.appTable?"block":"none"},children:e.jsx(Ve,{app:t})}),h()]}),T=()=>e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsx(is,{})}),h()]});return e.jsxs(e.Fragment,{children:[e.jsx(Gt,{activeStep:p,sx:{margin:"10px 0 30px 0"},children:d.map((j,y)=>(n.debug(j,y),e.jsx(qt,{children:e.jsx(Ht,{children:j})},j)))}),e.jsxs("form",{onSubmit:j=>(j.preventDefault(),i()&&c(p+1),!1),style:{display:"grid",gridGap:"40px"},children:[p===0&&C(),p===1&&v(),p===2&&T(),e.jsx("input",{type:"submit",style:{display:"none"}})]})]})},hr=({setMode:s})=>{const r=be();n.debug(r);const[t,l]=f.useState(!1),[d,p]=f.useState(!1),c=t?`Add new ${We(r.appType)} app`:"Add new app";return e.jsxs(e.Fragment,{children:[e.jsxs(ve,{sx:{padding:"50px 70px 40px 70px",display:"grid",gridGap:"40px"},elevation:4,children:[e.jsxs(o,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"start"},children:[e.jsx(Ft,{title:"App Wizard",subheader:c,sx:{padding:0}}),e.jsx(o,{children:e.jsx(G,{title:"Close",children:e.jsx(X,{sx:{cursor:"pointer"},underline:"none",onClick:g=>{p(!0),g.preventDefault(),g.stopPropagation()},children:e.jsx(o,{sx:{fontSize:"1.5rem",color:"#000"},children:e.jsx(He,{})})})})})]}),e.jsx(Me,{sx:{padding:0,display:"grid",gridGap:"30px"},children:t?e.jsx(xr,{setMode:s}):e.jsxs(o,{sx:{display:"grid",gap:"10px"},children:[e.jsx(ss,{app:r,isNew:!0}),e.jsx(o,{sx:{textAlign:"end"},children:e.jsx(V,{variant:"contained",size:"medium",endIcon:e.jsx($e,{}),onClick:()=>{l(!0)},sx:{width:"160px"},children:"Start Wizard"})})]})})]}),e.jsx(oe,{title:"Close App Wizard?",message:"All uncommitted changes will be lost!",open:d,setOpen:p,onConfirm:()=>{s(J.TABLE)}})]})};const Vr=()=>{const s=W(),r=f.useMemo(()=>st(),[]),[t,l]=f.useState(J.TABLE);n.debug(t),f.useEffect(()=>{const m=localStorage.getItem("ppAppsDbsSearch");m!==null&&s(Le({dbSearch:m}));const S=localStorage.getItem("ppAppsDbsSearchType");if(S!==null){const F=JSON.parse(S);s(Ee({dbTypes:F}))}},[]);const d=as(),p=Xt(),c=P(m=>Ns(m));n.debug("appDbId",c);const g=P(m=>Ls(m));n.debug("dbSearch",g);const A=P(m=>Es(m));n.debug("dbTypes",A);const x=P(m=>Ps(m));n.debug("designMode",x);const i=P(m=>_s(m));n.debug("reload",i);const[h,C]=f.useState(!0);f.useEffect(()=>{T(),v()},[i]);const v=()=>{Et(function(m){const S=m==null?void 0:m.data;n.debug("response data",S);const F=m==null?void 0:m.context;if(n.debug("response context",F),Array.isArray(S)){const U=[];for(let w=0;w<S.length;w++)U.push({appId:S[w].app_id,appName:S[w].app_name,appTitle:S[w].app_title,appType:S[w].app_type,appSettings:S[w].app_settings,appAddToMenu:S[w].app_add_to_menu});const re=F.reduce((w,N)=>{const{app_id:D,app_id_detail:ee}=N;return w[D]=w[D]??[],w[D].push(Number(ee)),w},{});s(Ae({appList:U,appApps:re}))}else n.error(S),u((S==null?void 0:S.message)??I.contactSupport,{variant:"error"}),s(Ae({appList:[],appApps:[]}));C(!1)},m=>{n.error("error",m),u(m??I.contactSupport,{variant:"error"}),s(Ae({appList:[],appApps:[]})),C(!1)})},T=()=>{Pt(function(m){const S=m==null?void 0:m.data;n.debug("response data",S),s(Fs({appMetaData:S}))},m=>{n.error("error",m),u(m??I.contactSupport,{variant:"error"})})};f.useEffect(()=>{t===J.TABLE&&T()},[t]),f.useEffect(()=>{zs.appPlugin&&(t===1||x.isActive===!0&&x.appDbId>0?window.document.documentElement.style.setProperty("--addAppIconVisibility","hidden"):window.document.documentElement.style.setProperty("--addAppIconVisibility","visible"),window.ppActionCreateApp=function(){t===0&&!(x.isActive===!0&&x.appDbId>0)&&l(J.FORM)})},[t,x]);const[j,y]=f.useState(250),R=ge("(max-width: 600px)"),O=ge("(max-width: 900px)");f.useEffect(()=>{Z.current&&y(Z.current.offsetWidth)},[A]);const b=Bs(),$=Fe();n.debug($);const Z=f.useRef(),K=()=>x.isActive===!0&&x.appDbId>0,a=()=>e.jsx(G,{title:"Add new app",children:e.jsx(q,{sx:{color:"inherit"},onClick:()=>{s(Be({})),l(J.FORM)},children:e.jsx(lt,{})})}),E={};K()&&(E.visibility="hidden");const k=localStorage.getItem("ppAppsDensity"),[Y,te]=f.useState(k==="large"||k==="medium"?k:"small");return f.useEffect(()=>{localStorage.setItem("ppAppsDensity",Y)},[Y]),e.jsxs(tt,{theme:b,children:[e.jsxs(o,{className:"pp-applist",sx:{width:"100%",visibility:K()?"hidden":"visible",position:K()?"fixed":"auto",height:K()?0:"auto",...K()&&{"& *":{visibility:"hidden"}},"& .pp-app-details":{...E}},children:[e.jsx(Ge,{position:"relative",elevation:4,sx:{margin:"0 0 5px 0"},children:e.jsxs(qe,{className:"pp-applist-toolbar",sx:{display:"grid",gap:"12px",paddingRight:"12px !important",...R?{gap:0,paddingRight:"10px",paddingBottom:"10px",paddingLeft:"10px","& .pp-applist-search":{gridTemplateColumns:"1fr",gridGap:"2px"}}:{...O?{gap:0,paddingRight:"10px",paddingBottom:"10px",paddingLeft:"10px","& .pp-applist-search":{justifyContent:"end",gridTemplateColumns:"auto auto auto"}}:{justifyContent:"space-between",gridTemplateColumns:"auto 1fr"}}},children:[e.jsxs(o,{className:"pp-applist-title",sx:{display:"inline-grid",gridTemplateColumns:"auto auto",justifyContent:"start",alignItems:"center",gridGap:"10px"},children:[e.jsx(o,{sx:{fontSize:"18px",lineHeight:"18px",fontWeight:"bold",whiteSpace:"nowrap"},children:"Apps"}),e.jsx(o,{children:a()})]}),e.jsxs(o,{className:"pp-applist-search",sx:{display:"grid",gridTemplateColumns:"auto auto auto",gridGap:"10px",justifyContent:"end",alignItems:"center"},children:[e.jsxs(o,{children:[e.jsx(G,{title:"App View",children:e.jsx(q,{onClick:()=>{s(Pe({showAppStructure:!0}))},sx:{color:"#fff"},children:e.jsx(rt,{})})}),e.jsx(G,{title:"List View",children:e.jsx(q,{onClick:()=>{s(Pe({showAppStructure:!1}))},sx:{color:"#fff"},children:e.jsx(at,{})})}),e.jsx(G,{title:"Toggle density",children:e.jsx(q,{onClick:()=>{te(Y==="large"?"medium":Y==="medium"?"small":"large")},sx:{color:"#fff"},children:Y==="small"?e.jsx(nt,{}):Y==="medium"?e.jsx(it,{}):e.jsx(ot,{})})})]}),e.jsx(Q,{value:g,type:"search",placeholder:"Search",disabled:t===J.FORM,onChange:m=>{s(Le({dbSearch:m.target.value})),localStorage.setItem("ppAppsDbsSearch",m.target.value)},sx:{backgroundColor:"#fff",fontSize:"1em",margin:0,padding:0,borderRadius:"4px","&.MuiFormControl-root.MuiTextField-root .MuiInputBase-root":{paddingRight:0},"&.MuiFormControl-root.MuiTextField-root input":{padding:"8px"}},InputProps:{startAdornment:e.jsx(Yt,{position:"end",sx:{fontSize:"1.5rem",padding:0,margin:0},children:e.jsx(pt,{})})}}),e.jsx(fe,{multiple:!0,size:"small",options:$,getOptionLabel:m=>m.text,isOptionEqualToValue:(m,S)=>m.id===S.id,value:A,disableCloseOnSelect:!0,disabled:t===J.FORM,onChange:(m,S)=>{s(Ee({dbTypes:S.map(F=>({id:F.id,text:Object.values(Os)[F.id]}))})),localStorage.setItem("ppAppsDbsSearchType",JSON.stringify(S))},PaperComponent:({children:m})=>e.jsx(Qe,{sx:{width:`${j}px`},children:m}),renderInput:m=>e.jsx(o,{ref:Z,children:e.jsx(Q,{...m,sx:{minWidth:"250px","& .MuiInputBase-root":{backgroundColor:"#fff",padding:"0",maxHeight:"39px",overflow:"hidden"},"& .MuiButtonBase-root.MuiChip-root.MuiAutocomplete-tag":{height:"auto"}},placeholder:A.length===0?"Select app types":""})}),renderTags:(m,S)=>m.map((F,U)=>{const{key:re,...w}=S({index:U});return e.jsx(je,{variant:"outlined",label:F.text,...w},re)})})]})]})}),t===J.TABLE&&e.jsx(ur,{apps:d,appApps:p,search:g,types:A,isLoading:h,density:Y}),t===J.FORM&&e.jsx(hr,{setMode:l}),c!==0&&c!==void 0&&e.jsx(cr,{appDbId:c})]}),x.isActive===!0&&x.appDbId>0&&e.jsx($t,{appId:r,appDbId:x.appDbId,designMode:!0,isExploring:!0})]})};export{Vr as default};
